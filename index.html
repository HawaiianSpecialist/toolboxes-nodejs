<!doctype html>
<html class="no-js" lang="">

<head>
  <meta charset="utf-8">
  <title></title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="manifest" href="site.webmanifest">
  <link rel="apple-touch-icon" href="icon.png">
  <!-- Place favicon.ico in the root directory -->

  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/main.css">

  <meta name="theme-color" content="#fafafa">
</head>

<body>
  <!--[if IE]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->

  <!-- Add your site or application content here -->
  <table id="table">
    <thead>
      <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Size</th>
        <th>Manufactuer</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
    </tbody>
  </table>

  <script src="js/vendor/modernizr-3.7.1.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"
    integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
  <script>window.jQuery || document.write('<script src="js/vendor/jquery-3.4.1.min.js"><\/script>')</script>
  <script src="js/plugins.js"></script>
  <script src="js/main.js"></script>

  <script>

    var host = "http://localhost:3000";

    function renderer(data)
    {
      if (data)
      {
        //TODO: first need to delete all the table's rows
        // var rows = document.getElementById("table").getElementsByTagName("tbody")[0].getElementsByTagName("tr").length;

        // for(var i = 0; i<rows; i++)
        // {
        //  document.getElementById("table").deleteRow(i);
        // }
        var Parent = document.getElementById("table").getElementsByTagName("tbody")[0];
        while (Parent.hasChildNodes())
        {
          Parent.removeChild(Parent.firstChild);
        }


        //document.getElementById("Table").deleteRow(0);

        //next update table with data sent back.
        for (let i = 0; i < data.length; i++)
        {
          $('#table tbody').append("<tr><td contenteditable='false'>" + data[i].id +
            "</td><td contenteditable='true'>" + data[i].name +
            "</td><td contenteditable='true'>" + data[i].size +
            "</td><td contenteditable='true'>" + data[i].manufacturer +
            "</td><td contenteditable='true'>" + data[i].description +
            "</td><td contenteditable='false'><button onclick='updateRecord(" + i + ")'>Update</button><button onclick='deleteRecord(" + i + ")'>Delete</button></td></tr>");
        }

        // Add blank record to be able to add new tool
      }
    }

    function retrieveRecord()
    {
      $.ajax({
        type: 'GET',
        url: host + '/retrieve',
        dataType: "json", //to parse string into JSON object,
        success: function (data)
        {
          renderer(data);
        },
        error: function (jqXHR, textStatus, errorThrown)
        {
          alert('error: ' + textStatus + ': ' + errorThrown);
        }
      });
    }

    function updateRecord(row)
    {
      var url = host + "/update?";
      cells = $("#table").find("tbody tr").eq(row).children();
      url += "id=" + cells[0].textContent + "&name=" + cells[1].textContent + "&size=" + cells[2].textContent + "&manufacturer=" + cells[3].textContent + "&description=" + cells[4].textContent;
      $.ajax({
        type: 'GET',
        url: url,
        dataType: "json", //to parse string into JSON object,
        success: function (data)
        {
          renderer(data);
        },
        error: function (jqXHR, textStatus, errorThrown)
        {
          alert('error: ' + textStatus + ': ' + errorThrown);
        }
      });
    }

    function deleteRecord(row)
    {
      var url = host + "/delete?";
      cells = $("#table").find("tbody tr").eq(row).children();
      url += "id=" + cells[0].textContent;
      $.ajax({
        type: 'GET',
        url: url,
        dataType: "json", //to parse string into JSON object,
        success: function (data)
        {
          renderer(data);
        },
        error: function (jqXHR, textStatus, errorThrown)
        {
          alert('error: ' + textStatus + ': ' + errorThrown);
        }
      });
    }

    retrieveRecord();

  </script>


  <!-- Google Analytics: change UA-XXXXX-Y to be your site's ID. -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-XXXXX-Y', 'auto'); ga('set', 'transport', 'beacon'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async></script>
</body>

</html>